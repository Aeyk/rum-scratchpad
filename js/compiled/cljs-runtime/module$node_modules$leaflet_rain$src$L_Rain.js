shadow$provide.module$node_modules$leaflet_rain$src$L_Rain=function(global,require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _leaflet=_interopRequireDefault(require("module$node_modules$leaflet$dist$leaflet_src")),_matrixUtils=_interopRequireDefault(require("module$node_modules$leaflet_rain$src$matrixUtils$index"));require=require("module$node_modules$glslify$index");global=require("./shaders/vertex.glsl");require=require("./shaders/fragment.glsl");
_leaflet["default"].Rain=_leaflet["default"].Polygon.extend({options:{angle:80,width:1,spacing:10,length:4,interval:10,speed:1,color:"Oxa6b3e9",vertexShader:global,fragmentShader:require},onAdd:function(map){this._map=map;if(!this._canvas){var canvas=this._canvas=this._initCanvas(map);var gl=this._gl=this._initWebGl(canvas)}this._initShaders(gl);gl&&(gl.clearColor(0,0,0,0),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT));this.options.pane?this.getPane().appendChild(canvas):
map._panes.overlayPane.appendChild(canvas);map.on("move",this._reset,this);map.on("resize",this._resize,this);if(map.options.zoomAnimation&&_leaflet["default"].Browser.any3d)map.on("zoomanim",this._animateZoom,this);this._reset()},onRemove:function(map){var canvas=this._canvas;this.options.pane?this.getPane().removeChild(canvas):map.getPanes().overlayPane.removeChild(canvas);map.off("moveend",this._reset,this);map.options.zoomAnimation&&map.off("zoomanim",this._animateZoom,this)},addTo:function(map){map.addLayer(this);
return this},drawScene:function(){var currentIndex=0,gl=this._gl;gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);var polygonsCount=this._latlngs.length;for(var i=0;i<polygonsCount;i++){var count=this._latlngs[i].length;this._updateMatrix(gl);gl.drawArrays(gl.TRIANGLE_FAN,currentIndex,count);currentIndex+=count}},render:function(){var gl=this._gl,time=_leaflet["default"].Util.requestAnimFrame(this.render.bind(this)),timeLocation=gl.getUniformLocation(this.shaderProgram,"u_time");gl.uniform1f(timeLocation,
time);this.drawScene()},setAngle:function(angle){var gl=this._gl,angleLocation=gl.getUniformLocation(this.shaderProgram,"u_angle"),rad=angle*Math.PI/180-Math.PI/2;this.options.angle=angle;gl.uniform1f(angleLocation,rad);this._redraw()},setWidth:function(width){var gl=this._gl,widthLocation=gl.getUniformLocation(this.shaderProgram,"u_width");this.options.width=width;gl.uniform1f(widthLocation,width);this._redraw()},setSpacing:function(spacing){var gl=this._gl,spacingLocation=gl.getUniformLocation(this.shaderProgram,
"u_spacing");this.options.spacing=spacing;gl.uniform1f(spacingLocation,spacing);this._redraw()},setLength:function(length){var gl=this._gl,lengthLocation=gl.getUniformLocation(this.shaderProgram,"u_length");this.options.length=length;gl.uniform1f(lengthLocation,length);this._redraw()},setInterval:function(interval){var gl=this._gl,intervalLocation=gl.getUniformLocation(this.shaderProgram,"u_interval");this.options.interval=interval;gl.uniform1f(intervalLocation,interval);this._redraw()},setSpeed:function(speed){var gl=
this._gl,speedLocation=gl.getUniformLocation(this.shaderProgram,"u_speed");this.options.speed=speed;gl.uniform1f(speedLocation,speed);this._redraw()},setColor:function(color){var gl=this._gl,colorLocation=gl.getUniformLocation(this.shaderProgram,"u_color");"#"===color[0]&&(color=color.replace("#","0x"),this.options.color=color,gl.uniform1i(colorLocation,color),this._redraw())},_initCanvas:function(){var canvas=_leaflet["default"].DomUtil.create("canvas","webgl-canvas leaflet-layer"),originProp=_leaflet["default"].DomUtil.testProp(["transformOrigin",
"WebkitTransformOrigin","msTransformOrigin"]);canvas.style[originProp]="50% 50%";originProp=this._map.getSize();canvas.width=originProp.x;canvas.height=originProp.y;canvas.style.position="absolute";_leaflet["default"].DomUtil.addClass(canvas,"leaflet-zoom-"+(this._map.options.zoomAnimation&&_leaflet["default"].Browser.any3d?"animated":"hide"));return canvas},_initShaders:function(gl){var _this$options=this.options,fragmentShader=_this$options.fragmentShader,angle=_this$options.angle,width=_this$options.width,
spacing=_this$options.spacing,length=_this$options.length,interval=_this$options.interval,speed=_this$options.speed,color=_this$options.color;_this$options=this._getShader("vertex",_this$options.vertexShader);var fShader=this._getShader("fragment",fragmentShader);fragmentShader=this.shaderProgram=gl.createProgram();gl.attachShader(fragmentShader,_this$options);gl.attachShader(fragmentShader,fShader);gl.linkProgram(fragmentShader);gl.getProgramParameter(fragmentShader,gl.LINK_STATUS)||alert("Unable to initialize the shader program.");
gl.viewport(0,0,gl.canvas.width,gl.canvas.height);gl.useProgram(fragmentShader);gl.enable(gl.BLEND);gl.blendFunc(gl.SRC_ALPHA,gl.ONE);_this$options=gl.getUniformLocation(fragmentShader,"u_angle");fShader=gl.getUniformLocation(fragmentShader,"u_spacing");var widthLocation=gl.getUniformLocation(fragmentShader,"u_width");gl.getUniformLocation(fragmentShader,"u_legnth");var lengthLocation=gl.getUniformLocation(fragmentShader,"u_length");var intervalLocation=gl.getUniformLocation(fragmentShader,"u_interval"),
speedLocation=gl.getUniformLocation(fragmentShader,"u_speed");fragmentShader=gl.getUniformLocation(fragmentShader,"u_color");gl.uniform1f(_this$options,angle*Math.PI/180-Math.PI/2);gl.uniform1f(widthLocation,width);gl.uniform1f(fShader,spacing);gl.uniform1f(lengthLocation,length);gl.uniform1f(intervalLocation,interval);gl.uniform1f(speedLocation,speed);"#"===color[0]&&(this.options.color=color.replace("#","0x"));gl.uniform1i(fragmentShader,this.options.color);this.render()},_initWebGl:function(canvas){var gl=
null;try{gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl")}catch(e){}gl||(console.warn("Unable to initialize WebGL. Your browser may not support it."),gl=null);return gl},_getShader:function(type,source){var gl=this._gl,shader=gl.createShader("vertex"==type?gl.VERTEX_SHADER:gl.FRAGMENT_SHADER);if(!type)return null;gl.shaderSource(shader,source);gl.compileShader(shader);return gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(alert("An error occurred compiling the shaders: "+
gl.getShaderInfoLog(shader)),null)},_updateMatrix:function(gl){var matrixLocation=gl.getUniformLocation(this.shaderProgram,"u_matrix"),map=this._map,center=map.getCenter(),zoom=map.getZoom(),crs=map.options.crs,CRSCenter=crs.project(center);center=CRSCenter.x;CRSCenter=CRSCenter.y;var pxSize=crs.transformation.untransform(_leaflet["default"].point([1,1]),1);map=map.getSize().divideBy(crs.scale(zoom));zoom=pxSize.scaleBy(map);map=_matrixUtils["default"].identityMatrix();center=_matrixUtils["default"].translationMatrix([-center,
-CRSCenter,0]);CRSCenter=_matrixUtils["default"].scaleMatrix([1/zoom.x,-1/zoom.y,1]);map=_matrixUtils["default"].matrixMultiply(map,center);map=_matrixUtils["default"].matrixMultiply(map,CRSCenter);gl.uniformMatrix4fv(matrixLocation,!1,map)},_reset:function(){var topLeft=this._map.containerPointToLayerPoint([0,0]);_leaflet["default"].DomUtil.setPosition(this._canvas,topLeft);this._redraw()},_resize:function(e){e=e.newSize;this._canvas.width=e.x;this._canvas.height=e.y;this._reset()},_redraw:function(){var gl=
this._gl,positionLocation=gl.getAttribLocation(this.shaderProgram,"a_position"),projectLatLng=this._projectLatLng.bind(this),bufArray=[].concat.apply([],this._latlngs).map(function(ll){return projectLatLng(ll)}).reduce(function(previousValue,currentValue){return previousValue.concat(currentValue)},[]),buf=gl.createBuffer(),resolutionLocation=gl.getUniformLocation(this.shaderProgram,"u_resolution");gl.uniform2fv(resolutionLocation,[this._canvas.width,this._canvas.height]);gl.bindBuffer(gl.ARRAY_BUFFER,
buf);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(bufArray),gl.STATIC_DRAW);gl.enableVertexAttribArray(positionLocation);gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,!1,8,0)},_projectLatLng:function(latLng){latLng=this._map.options.crs.project(latLng);return[latLng.x,latLng.y]},_animateZoom:function(e){var scale=this._map.getZoomScale(e.zoom);e=this._map._getCenterOffset(e.center)._multiplyBy(-scale).subtract(this._map._getMapPanePos());_leaflet["default"].DomUtil.setTransform?_leaflet["default"].DomUtil.setTransform(this._canvas,
e,scale):this._canvas.style[_leaflet["default"].DomUtil.TRANSFORM]=_leaflet["default"].DomUtil.getTranslateString(e)+" scale("+scale+")"}});_leaflet["default"].rain=function(latlngs,options){return new _leaflet["default"].Rain(latlngs,options)}}
//# sourceMappingURL=module$node_modules$leaflet_rain$src$L_Rain.js.map
