shadow$provide.module$node_modules$$tonejs$piano$build$piano$Strings=function(global,require,module,exports){function _typeof(obj$jscomp$0){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};return _typeof(obj$jscomp$0)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=
descriptor.enumerable||!1;descriptor.configurable=!0;"value"in descriptor&&(descriptor.writable=!0);Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps);staticProps&&_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"===typeof call))return call;if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return self}function _getPrototypeOf(o$jscomp$0){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o$jscomp$0)}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});superClass&&
_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o$jscomp$0,p$jscomp$0){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o$jscomp$0,p$jscomp$0)}Object.defineProperty(exports,"__esModule",{value:!0});exports.PianoStrings=void 0;var _tone=require("module$node_modules$tone$build$Tone");global=require("module$node_modules$$tonejs$piano$build$piano$Component");var _Salamander=require("module$node_modules$$tonejs$piano$build$piano$Salamander"),
_String=require("module$node_modules$$tonejs$piano$build$piano$String"),__awaiter=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,
rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};require=function(_PianoComponent){function PianoStrings(options){if(!(this instanceof PianoStrings))throw new TypeError("Cannot call a class as a function");var _this=_possibleConstructorReturn(this,_getPrototypeOf(PianoStrings).call(this,options));var notes=(0,_Salamander.getNotesInRange)(options.minNote,options.maxNote),velocities=_Salamander.velocitiesMap[options.velocities].slice();_this._strings=velocities.map(function(velocity){return new _String.PianoString(Object.assign(options,
{notes,velocity}))});_this._activeNotes=new Map;return _this}_inherits(PianoStrings,_PianoComponent);_createClass(PianoStrings,[{key:"scale",value:function(val,inMin,inMax,outMin,outMax){return(val-inMin)/(inMax-inMin)*(outMax-outMin)+outMin}},{key:"triggerAttack",value:function(note,time,velocity){var scaledVel=this.scale(velocity,0,1,-.5,this._strings.length-.51),stringIndex=Math.max(Math.round(scaledVel),0);scaledVel=1+scaledVel-stringIndex;1===this._strings.length&&(scaledVel=velocity);velocity=
this._strings[stringIndex];this._activeNotes.has(note)&&this.triggerRelease(note,time);this._activeNotes.set(note,velocity);velocity.triggerAttack((0,_tone.Midi)(note).toNote(),time,scaledVel)}},{key:"triggerRelease",value:function(note,time){this._activeNotes.has(note)&&(this._activeNotes.get(note).triggerRelease((0,_tone.Midi)(note).toNote(),time),this._activeNotes["delete"](note))}},{key:"_internalLoad",value:function(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function _callee2(){var _this2=
this;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Promise.all(this._strings.map(function(s){return __awaiter(_this2,void 0,void 0,regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,s.load();case 2:s.connect(this.output);case 3:case "end":return _context.stop()}},_callee,this)}))}));case 2:case "end":return _context2.stop()}},
_callee2,this)}))}}]);return PianoStrings}(global.PianoComponent);exports.PianoStrings=require}
//# sourceMappingURL=module$node_modules$$tonejs$piano$build$piano$Strings.js.map
